<main>
  <!-- Overview -->
  <section class="overview">
    <div class="grid">
      <div class="grid-cell">
        <h2>Overview</h2>
        <ul class="toggle" [ngStyle]="hideElement(!userLoggedIn())">
          <li id="toggle-your-liquidity" class="{{!isAllLiquidityOverviewActive() ? 'active': ''}}" (click)="onYourLiquidityClick()">Your rewards</li>
          <li id="toggle-all-liquidity" class="{{isAllLiquidityOverviewActive() ? 'active': ''}}" (click)="onAllLiquidityClick()">All rewards</li>
        </ul>
      </div>
    </div>

    <!-- Your liquidity -->
    <div id="your-liquidity" class="grid panel" [ngStyle]="hideElement(isAllLiquidityOverviewActive() || !userLoggedIn())">

      <ng-container *ngIf="rewardsTimeStampsActivated() && !rewardsAccrueStartDateHasPassed() && false">
        <!-- If the timestamp of omm rewards accrue is not yet passed -->
        <div class="grid-cell text-center">
          <dt>Omm rewards will start accruing in 24 hours.</dt>
        </div>
      </ng-container>

      <ng-container *ngIf="!rewardsTimeStampsActivated() || rewardsAccrueStartDateHasPassed() || true">

        <ng-container *ngIf="rewardsTimeStampsActivated() && !rewardsClaimStartDateHasPassed()">
          <div class="grid-cell text-center border-right">
            <dl class="metadata">
              <dt>Claimable in {{getTimeUntilClaimStart()}}
              </dt>
              <dd>{{getUserOmmRewardsBalance() | roundOff2Dec | usFormat}} <span class="label">{{getUserOmmRewardsBalance().isGreaterThan(ZERO) ? "OMM" :  ""}}</span></dd>
            </dl>
          </div>
        </ng-container>

        <ng-container *ngIf="!rewardsTimeStampsActivated() || rewardsClaimStartDateHasPassed()">
          <!-- Claim rewards -->
          <div class="grid-cell text-center border-right" [ngStyle]="hideElement(shouldHideClaimBtn())">
            <p class="label">{{getUserOmmRewardsBalance() | roundDown2Dec | usFormat}} Omm Tokens</p>
            <a href="javascript:void(0);" class="button modal-trigger" style="margin-top: 5px;" data-modal="modal-claim-rewards"
               (click)="onClaimOmmRewardsClick()" >Claim rewards</a>
          </div>

          <!-- No rewards to claim -->
          <div class="grid-cell text-center border-right" [ngStyle]="hideElement(!shouldHideClaimBtn())">
            <p style="margin-top: 25px;" class="label">No rewards to claim</p>
          </div>
        </ng-container>

        <!-- Market rewards -->
        <div class="grid-cell text-center">
          <dl class="metadata">
            <dt>Markets
              <span class="tooltip expanded-risk-tooltip">
              <span class="tooltip-item"><img src="assets/img/icon/question.svg" class="tooltip-icon"></span>
              <div class="tooltip-content"><p>The amount you've earned by supplying or borrowing assets since you last claimed.</p></div>
            </span>
            </dt>
            <dd [ngStyle]="{opacity: getUserMarketRewards().gt(ZERO) ? null : 0.5}">{{getUserMarketRewards() | roundOff2Dec | usFormat}} <span class="label">{{getUserMarketRewards().gt(ZERO) ? "OMM" :  ""}}</span></dd>
          </dl>
        </div>

        <!-- Staking rewards -->
        <div class="grid-cell text-center">
          <dl class="metadata">
            <dt>Boosted OMM
              <span class="tooltip expanded-risk-tooltip">
              <span class="tooltip-item"><img src="assets/img/icon/question.svg" class="tooltip-icon"></span>
              <div class="tooltip-content"><p>The amount you've earned from your locked OMM since you last claimed.</p></div>
            </span>
            </dt>
            <dd [ngStyle]="{opacity: getUserLockingRewards().gt(ZERO) ? null : 0.5}">{{getUserLockingRewards() | roundOff2Dec | usFormat}} <span class="label">{{getUserLockingRewards().isGreaterThan(ZERO) ? "OMM" :  ""}}</span></dd>
          </dl>
        </div>

        <!-- Liquidity rewards -->
        <div class="grid-cell text-center">
          <dl class="metadata">
            <dt>Liquidity
              <span class="tooltip expanded-risk-tooltip">
              <span class="tooltip-item"><img src="assets/img/icon/question.svg" class="tooltip-icon"></span>
              <div class="tooltip-content"><p>The amount you've earned by staking LP tokens since you last claimed.</p></div>
            </span>
            </dt>
            <dd [ngStyle]="{opacity: getUserLiquidityRewards().gt(ZERO) ? null : 0.5}">{{getUserLiquidityRewards() | roundOff2Dec | usFormat}} <span class="label">{{getUserLiquidityRewards().isGreaterThan(ZERO) ? "OMM" :  ""}}</span></dd>
          </dl>
        </div>
      </ng-container>
    </div>

    <!-- All liquidity -->
    <div id="all-liquidity" class="grid panel" [ngStyle]="hideElement(!isAllLiquidityOverviewActive())">
      <div class="grid-cell text-center border-right">
        <dl class="metadata">
          <dt>Total daily rewards</dt>
          <dd>{{getTotalDailyRewards() | roundOff2Dec | usFormat}} <span class="label">{{getTotalDailyRewards().isGreaterThan(ZERO) ? "OMM":""}}</span></dd>
        </dl>
      </div>
      <div class="grid-cell text-center">
        <dl class="metadata">
          <dt>Markets
            <span class="tooltip expanded-risk-tooltip">
              <span class="tooltip-item"><img src="assets/img/icon/question.svg" class="tooltip-icon"></span>
              <div class="tooltip-content"><p>Supply or borrow from a market to earn these rewards.</p></div>
            </span>
          </dt>
          <dd>{{getDailyMarketRewards() | roundOff2Dec | usFormat}} <span class="label">{{getDailyMarketRewards().isGreaterThan(ZERO) ? "OMM":""}}</span></dd>
        </dl>
      </div>
      <div class="grid-cell text-center">
        <dl class="metadata">
          <dt>Boosted OMM
            <span class="tooltip expanded-risk-tooltip">
            <span class="tooltip-item"><img src="assets/img/icon/question.svg" class="tooltip-icon"></span>
            <div class="tooltip-content"><p>Lock up OMM to earn these rewards.</p></div>
          </span>
          </dt>
          <dd>{{getDailyOmmLockingRewards() | roundOff2Dec | usFormat}} <span class="label">{{getDailyOmmLockingRewards().isGreaterThan(ZERO) ? "OMM":""}}</span></dd>
        </dl>
      </div>
      <div class="grid-cell text-center">
        <dl class="metadata">
          <dt>Liquidity
            <span class="tooltip expanded-risk-tooltip">
              <span class="tooltip-item"><img src="assets/img/icon/question.svg" class="tooltip-icon"></span>
              <div class="tooltip-content"><p>Supply OMM liquidity on Balanced, then stake your LP tokens here to earn rewards.</p></div>
            </span>
          </dt>
          <dd>{{getDailyLiquidityRewards() | roundOff2Dec | usFormat}} <span class="label">{{getDailyLiquidityRewards().isGreaterThan(ZERO) ? "OMM":""}}</span></dd>
        </dl>
      </div>
    </div>
  </section>

  <!-- Boosted Omm -->
  <section class="boosted-omm">
    <div class="grid">
      <div class="grid-cell">
        <h2>Boosted OMM</h2>
      </div>

      <div class="grid-cell">

      </div>
    </div>

    <!-- Boosted OMM panel -->
    <div class="grid panel">
      <div class="grid-cell">
        <div class="grid">
          <div class="grid-cell boosted-container">
            <!-- Header -->
            <div class="grid">
              <!-- Heading -->
              <div class="grid-cell">
                <h3>Earning potential <span *ngIf="!userBOMMbalance().isZero() && userBOMMbalance().isPositive()" class="label value-bomm-total">{{userBOMMbalance() | roundDown2Dec | usFormat | toZeroIfDash }} bOMM</span>
                  <span class="bomm-tooltip tooltip">
                    <span class="tooltip-item"><img src="assets/img/icon/question.svg" class="tooltip-icon"></span>
                    <div class="tooltip-content">
                      <p class="bomm-tooltip-content">
                        Lock up OMM to boost your earning potential by up to 2.5 x. The longer you lock up OMM,
                        the more bOMM (boosted OMM) you'll receive; the amount will decrease over time.
                      </p>
                    </div>
                  </span>
                </h3>
              </div>
              <!-- Button -->
              <div class="grid-cell" [ngStyle]="hideElement(shouldHideBoostedSlider())">
                <p class="text-right" [ngStyle]="hideElement(lockAdjustActive)">
                  <a href="javascript:void(0);" class="button" id="boost-adjust" style="margin-top: 0;" (click)="onLockAdjustClick()">{{boostAdjustLabel()}}</a>
                </p>

                <div class="boost-adjust-actions" [ngStyle]="hideElement(!lockAdjustActive)">
                  <div class="grid">
                    <div class="grid-cell">
                      <div class="grid grid-center">
                        <div class="grid-cell text-right">
                          <a href="javascript:void(0);" class="cancel boost-cancel" (click)="onLockAdjustCancelClick()">Cancel</a>
                        </div>
                        <div class="grid-cell">
                          <a href="javascript:void(0);" class="button modal-trigger" style="margin-top: 0;"
                             data-modal="modal-boost-confirm" (click)="onConfirmLockOmmClick()">Confirm</a>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <p class="label intro-label" [ngStyle]="hideElement(lockAdjustActive)">{{boostedOmmPanelMessage()}}</p>
            <div class="threshold locked boost {{shouldHideLockedOmmThreshold() ? 'hide':''}}" [ngStyle]="getLeftLockedThresholdPercentStyle()">
              <dl class="metadata">
                <dt>Locked</dt>
              </dl>
            </div>
            <div id="slider-boost" class="{{lockAdjustActive ? 'active' : ''}}" disabled="" #stkSlider [ngStyle]="hideElement(shouldHideBoostedSlider())"></div>
            <div class="grid grid-center" [ngStyle]="hideElement(shouldHideBoostedSlider())">
              <div class="grid-cell" style="max-width: 200px;">
                <p class="label">
                  <input [ngStyle]="hideElement(!lockAdjustActive)" #lockInput id="input-boost" (input)="onInputLockChange()"
                         class="input-boost" type="text" name=""><span [ngStyle]="hideElement(lockAdjustActive)" class="omm-locked">{{userLockedOmmBalance | roundDown2Dec | usFormat}}</span> / {{getLockSliderMax() | usFormat}} OMM</p>
              </div>
              <div class="grid-cell text-right">
                <p class="label locked-default" [ngStyle]="hideElement(lockAdjustActive || userLockedOmmBalance.isZero())">Locked until {{timestampInMillisecondsToPrettyDate(lockDate())}}</p>
                <div class="locked-adjust" [ngStyle]="hideElement(!lockAdjustActive)">
                  <p>
                    <span class="label">Locked until </span> <a class="dropdown time-selector" (click)="onLockedDateDropdownClick()">
                    <span class="animation-underline locked-selector">{{timestampInMillisecondsToPrettyDate(lockDate())}}</span></a></p>
                  <div class="grid dropdown-content locked-selector">
                    <div class="grid-cell">
                      <ul>
                        <ng-container *ngFor="let date of lockedUntilDateOptions;">
                          <li (click)="onLockUntilDateClick(date)">{{date}}</li>
                        </ng-container>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="grid">
          <div class="grid-cell boost-increase border-top">
            <div class="grid">
              <div class="grid-cell border-right">
                <dl class="metadata">
                  <dt>Daily rewards</dt>
                  <dd >
                    <ng-container *ngIf="showBoostedOmmDailyRewardsOmmAmount()">
                      <span #lockDailyRew>{{getUserOmmLockingDailyRewards() | roundOff2Dec | usFormat}} OMM&nbsp;</span><span class="label">(<span class=" text-green">{{to2DecimalRoundedOffPercentString(lockingApr())}} APR</span>)</span>
                    </ng-container>
                    <ng-container *ngIf="!showBoostedOmmDailyRewardsOmmAmount()">
                      <span class=" text-green">{{to2DecimalRoundedOffPercentString(lockingApr())}} APR</span>
                    </ng-container>
                  </dd>
                </dl>
              </div>
              <div class="grid-cell border-right">
                <dl class="metadata">
                  <dt>Market rewards</dt>
                  <ng-container *ngIf="!fromToIsEmpty(usersBoostedOmmMarketRewards())">
                    <dd>
                      <span class="value-liquidity-apy-4">{{usersBoostedOmmMarketRewards().from | usFormat}} x</span>
                      <span *ngIf="!marketMultipliersAreEqual()" class="label"> – </span>
                      <span *ngIf="!marketMultipliersAreEqual()" class="value-liquidity-apy-2">{{usersBoostedOmmMarketRewards().to | usFormat}} x</span>
                    </dd>
                  </ng-container>
                  <ng-container *ngIf="fromToIsEmpty(usersBoostedOmmMarketRewards())">
                    <dd>–</dd>
                  </ng-container>
                </dl>
              </div>
              <div class="grid-cell">
                <dl class="metadata">
                  <dt>Liquidity rewards</dt>
                  <ng-container *ngIf="!fromToIsEmpty(usersBoostedOmmLiquidityRewards())">
                    <dd>
                      <span class="value-liquidity-apy-4">{{usersBoostedOmmLiquidityRewards().from | roundDown2Dec | usFormat}} x</span>
                      <span *ngIf="!liquidityMultipliersAreEqual()" class="label"> – </span>
                      <span *ngIf="!liquidityMultipliersAreEqual()" class="value-liquidity-apy-2">{{usersBoostedOmmLiquidityRewards().to | roundDown2Dec | usFormat}} x</span>
                    </dd>
                  </ng-container>
                  <ng-container *ngIf="fromToIsEmpty(usersBoostedOmmLiquidityRewards())">
                    <dd>–</dd>
                  </ng-container>
                </dl>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </section>

  <!-- Liquidity pools -->
  <section class="overview" [ngStyle]="hideElement(getAllPoolsData().length === 0)">
    <div class="grid">
      <div class="grid-cell">
        <h2>Liquidity pools</h2>
        <ul class="toggle" [ngStyle]="hideElement(!userLoggedIn())">
          <li id="toggle-your-pools" #toggYourPools class="{{!isAllPoolsActive() ? 'active': ''}}" (click)="onYourPoolsClick()">Your pools</li>
          <li id="toggle-all-pools" #toggAllPools class="{{isAllPoolsActive() ? 'active': ''}}" (click)="onAllPoolsClick()">All pools</li>
        </ul>
      </div>
    </div>

    <!-- If no pools or no LP tokens-->
    <p *ngIf="userLoggedIn() && !userHasStakedOrAvailableToAnyPool() && !isAllPoolsActive()" class="text-center" style="margin-top: 50px; max-width: 430px; margin-left: auto; margin-right: auto;"
    >You don’t have any LP tokens. Supply Omm assets to a liquidity pool on <a href="{{isProduction() ? 'https://app.balanced.network/trade' :'https://omm.balanced.network/trade'}}" target="_blank" style="font-size: 16px;">Balanced</a>, then come back here.<br>
      <br>Includes the risk of impermanent loss, so it’s best for advanced users. <a href="https://docs.omm.finance/user-guide/liquidity" target="_blank" style="font-size: 16px;">Learn more.</a></p>

    <table id="your-pools" class="list liquidity" [ngClass]="isAllPoolsActive() || !userLoggedIn() || !userHasStakedOrAvailableToAnyPool() ? 'hide':''">
      <thead>
      <tr [ngStyle]="hideElement(shouldHideYourPoolsHeader())">
        <th>Pool</th>
        <th>You've supplied</th>
        <th>LP tokens</th>
        <th>Daily rewards</th>
        <th>Liquidity APR</th>
      </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let poolData of getUserStakedPoolsData(); last as isLast;">
          <ng-container *ngIf="userHasStakedToPool(poolData)">
            <tr class="pool {{poolData.getPairClassName()}}" (click)="onPoolClick(poolData)">
              <td class="text-dark">{{poolData.getPrettyName()}}</td>
              <td><span class="text-dark">{{getUserSuppliedBase(poolData) | roundOff2Dec | usFormat}} OMM</span><br>
                <span class="label">{{getUserSuppliedQuote(poolData) | roundOff2Dec | usFormat}} {{poolData.getQuoteAssetName()}}</span></td>
              <td><span class="text-dark">{{poolData.userStakedBalance | roundDown2Dec | usFormat}}</span><br>
                <span class="label">{{poolData.userAvailableBalance | roundDown2Dec | usFormat}} available</span></td>
              <td><span class="text-dark">{{getUserDailyRewards(poolData) | roundOff2Dec | usFormat}} OMM</span><br>
                <span class="label">{{toDollarUSLocaleString(getUserDailyRewardsUSD(poolData) | roundOff2Dec)}}</span></td>
              <td class="text-green">{{to2DecimalRoundedOffPercentString(getLiquidityApy(poolData))}}</td>
            </tr>

            <!-- Pool expanded -->
            <tr class="expanded">
              <td colspan="5">
                <div class="pool-expanded pool-{{poolData.getPairClassName()}}-expanded hide" #poolExpandedEl>
                  <div class="grid border-top">
                    <div class="grid-cell text-center content">
                      <h2>Stake LP tokens</h2>
                      <p>Supply liquidity on <a href="{{isProduction() ? 'https://app.balanced.network/trade' :'https://omm.balanced.network/trade'}}" target="_blank"
                      >Balanced</a>, then<br>stake your LP tokens here to earn OMM.</p>
                      <div class="slider-stake" disabled></div>

                      <app-pool-stake-slider *ngIf="userLoggedIn() && userHasLpTokenAvailableOrHasStaked(poolData.poolId)" [poolIdSet]="poolData.poolId"></app-pool-stake-slider>

                    </div>
                  </div>
                </div>
              </td>
            </tr>
          </ng-container>

          <!-- Spacer -->
          <tr *ngIf="!isLast || getUserPoolsAvailableData().length > 0" class="spacer"></tr>
        </ng-container>

        <!-- User available Assets (hide if user market view is not active) -->
        <ng-container *ngIf="getUserPoolsAvailableData().length > 0">

          <!-- Available to supply -->
          <tr class="available-to-supply">
            <td colspan="5">
              <div class="grid">
                <div class="grid-cell">
                  <p class="separator-full text-center"><span>Available to stake</span></p>
                </div>
              </div>
            </td>
          </tr>

          <ng-container *ngFor="let poolData of getUserPoolsAvailableData(); last as isLast;">
            <ng-container *ngIf="userHasAvailableStakeToPool(poolData)">
              <tr class="pool {{poolData.getPairClassName()}}" (click)="onPoolClick(poolData)">
                <td class="text-dark">{{poolData.getPrettyName()}}</td>
                <td colspan="2"><span class="text-dark">{{poolData.userAvailableBalance | roundDown2Dec | usFormat}} LP tokens</span></td>
                <td colspan="2" class="text-green">{{to2DecimalRoundedOffPercentString(getLiquidityApy(poolData))}}</td>
              </tr>

              <!-- Pool expanded -->
              <tr class="expanded">
                <td colspan="5">
                  <div class="pool-expanded pool-{{poolData.getPairClassName()}}-expanded hide">
                    <div class="grid border-top">
                      <div class="grid-cell text-center content">
                        <h2>Stake LP tokens</h2>
                        <p>Supply liquidity on <a href="{{isProduction() ? 'https://app.balanced.network/trade' :'https://omm.balanced.network/trade'}}" target="_blank"
                        >Balanced</a>, then<br>stake your LP tokens here to earn OMM.</p>
                        <div class="slider-stake" disabled></div>

                        <app-pool-stake-slider *ngIf="userLoggedIn() && userHasLpTokenAvailableOrHasStaked(poolData.poolId)" [poolIdSet]="poolData.poolId"></app-pool-stake-slider>

                      </div>
                    </div>
                  </div>
                </td>
              </tr>
            </ng-container>

            <!-- Spacer -->
            <tr *ngIf="!isLast" class="spacer"></tr>
          </ng-container>
        </ng-container>
      </tbody>
    </table>

    <!-- All pools -->
    <table id="all-pools" class="list liquidity" [ngClass]="!isAllPoolsActive() ? 'hide':''">
      <thead>
      <tr>
        <th>Pool</th>
        <th>Total supplied</th>
        <th>Total LP tokens</th>
        <th>Daily rewards</th>
        <th>Liquidity APR</th>
      </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let poolData of getAllPoolsData(); last as isLast;">
          <tr class="pool {{poolData.getPairClassName()}}" #allPool (click)="onPoolClick(poolData)">
            <td class="text-dark">{{poolData.getPrettyName()}}</td>
            <td><span class="text-dark">{{getTotalSuppliedBase(poolData) | roundOff2Dec | usFormat}} OMM</span><br>
              <span class="label">{{getTotalSuppliedQuote(poolData) | roundOff2Dec | usFormat}} {{poolData.getQuoteAssetName()}}</span></td>
            <td><span class="text-dark">{{poolData.totalStakedBalance | roundOff2Dec | usFormat}}</span></td>
            <td><span class="text-dark">{{getDailyRewards(poolData) | roundOff2Dec | usFormat}} OMM</span><br>
              <span class="label">{{toDollarUSLocaleString(getDailyRewardsUSD(poolData) | roundOff2Dec)}}</span></td>
            <td class="text-green">{{to2DecimalRoundedOffPercentString(getLiquidityApy(poolData))}}</td>
          </tr>

          <tr class="expanded">
            <td colspan="5">
              <div class="pool-expanded pool-{{poolData.getPairClassName()}}-expanded hide">
                <div class="grid border-top">
                  <div class="grid-cell text-center content">
                    <h2>Stake LP tokens</h2>
                    <p>Supply liquidity on <a href="{{isProduction() ? 'https://app.balanced.network/trade' :'https://omm.balanced.network/trade'}}"
                                              target="_blank">Balanced</a>, then<br>stake your LP tokens here to earn OMM.</p>

                    <app-pool-stake-slider #stakeSlider *ngIf="userLoggedIn() && userHasLpTokenAvailableOrHasStaked(poolData.poolId)" [poolIdSet]="poolData.poolId"> </app-pool-stake-slider>
                  </div>
                </div>
              </div>
            </td>
          </tr>

          <!-- Spacer -->
          <tr *ngIf="!isLast" class="spacer"></tr>
        </ng-container>
      </tbody>
    </table>
  </section>
</main>
